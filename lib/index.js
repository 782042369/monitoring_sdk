!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self)["monitor-sdk"]={})}(this,(function(e){"use strict";function r(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function n(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function i(e,r,n){return r&&o(e.prototype,r),n&&o(e,n),e}function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function c(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&s(e,r)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,r){return(s=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function f(e,r,n){return(f=l()?Reflect.construct:function(e,r,n){var t=[null];t.push.apply(t,r);var o=new(Function.bind.apply(e,t));return n&&s(o,n.prototype),o}).apply(null,arguments)}function d(e){var r="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return f(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),s(t,e)})(e)}function p(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function h(e){var r=l();return function(){var n,t=u(e);if(r){var o=u(this).constructor;n=Reflect.construct(t,arguments,o)}else n=t.apply(this,arguments);return p(this,n)}}var g,v,O,m,y,E=function(){function e(){t(this,e)}return i(e,null,[{key:"JS_ERROR",get:function(){return"js_error"}},{key:"RESOURCE_ERROR",get:function(){return"resource_error"}},{key:"VUE_ERROR",get:function(){return"vue_error"}},{key:"PROMISE_ERROR",get:function(){return"promise_error"}},{key:"AJAX_ERROR",get:function(){return"ajax_error"}},{key:"CONSOLE_INFO",get:function(){return"console_info"}},{key:"CONSOLE_WARN",get:function(){return"console_warn"}},{key:"CONSOLE_ERROR",get:function(){return"console_error"}},{key:"CROSS_SCRIPT_ERROR",get:function(){return"cross_srcipt_error"}},{key:"UNKNOW_ERROR",get:function(){return"unknow_error"}},{key:"PERFORMANCE",get:function(){return"performance"}},{key:"NETWORK_SPEED",get:function(){return"network_speed"}}]),e}(),x=function(){function e(){t(this,e)}return i(e,null,[{key:"ERROR",get:function(){return"Error"}},{key:"WARN",get:function(){return"Warning"}},{key:"INFO",get:function(){return"Info"}}]),e}(),S=function(){function e(){t(this,e)}return i(e,null,[{key:"AXIOS",get:function(){return"axios"}},{key:"DEFAULT",get:function(){return"default"}}]),e}(),w=(g="undefined"!=typeof self?self:void 0,v=g||{},O={navigator:void 0!==g.navigator?g.navigator:{},infoMap:{engine:["WebKit","Trident","Gecko","Presto"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Arora","Lunascape","QupZilla","Coc Coc","Kindle","Iceweasel","Konqueror","Iceape","SeaMonkey","Epiphany","360","360SE","360EE","UC","QQBrowser","QQ","Baidu","Maxthon","Sogou","LBBROWSER","2345Explorer","TheWorld","XiaoMi","Quark","Qiyu","Wechat","Taobao","Alipay","Weibo","Douban","Suning","iQiYi"],os:["Windows","Linux","Mac OS","Android","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet","iPad"]}},m={getMatchMap:function(e){return{Trident:e.indexOf("Trident")>-1||e.indexOf("NET CLR")>-1,Presto:e.indexOf("Presto")>-1,WebKit:e.indexOf("AppleWebKit")>-1,Gecko:e.indexOf("Gecko/")>-1,Safari:e.indexOf("Safari")>-1,Chrome:e.indexOf("Chrome")>-1||e.indexOf("CriOS")>-1,IE:e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1,Edge:e.indexOf("Edge")>-1,Firefox:e.indexOf("Firefox")>-1||e.indexOf("FxiOS")>-1,"Firefox Focus":e.indexOf("Focus")>-1,Chromium:e.indexOf("Chromium")>-1,Opera:e.indexOf("Opera")>-1||e.indexOf("OPR")>-1,Vivaldi:e.indexOf("Vivaldi")>-1,Yandex:e.indexOf("YaBrowser")>-1,Arora:e.indexOf("Arora")>-1,Lunascape:e.indexOf("Lunascape")>-1,QupZilla:e.indexOf("QupZilla")>-1,"Coc Coc":e.indexOf("coc_coc_browser")>-1,Kindle:e.indexOf("Kindle")>-1||e.indexOf("Silk/")>-1,Iceweasel:e.indexOf("Iceweasel")>-1,Konqueror:e.indexOf("Konqueror")>-1,Iceape:e.indexOf("Iceape")>-1,SeaMonkey:e.indexOf("SeaMonkey")>-1,Epiphany:e.indexOf("Epiphany")>-1,360:e.indexOf("QihooBrowser")>-1||e.indexOf("QHBrowser")>-1,"360EE":e.indexOf("360EE")>-1,"360SE":e.indexOf("360SE")>-1,UC:e.indexOf("UC")>-1||e.indexOf(" UBrowser")>-1,QQBrowser:e.indexOf("QQBrowser")>-1,QQ:e.indexOf("QQ/")>-1,Baidu:e.indexOf("Baidu")>-1||e.indexOf("BIDUBrowser")>-1,Maxthon:e.indexOf("Maxthon")>-1,Sogou:e.indexOf("MetaSr")>-1||e.indexOf("Sogou")>-1,LBBROWSER:e.indexOf("LBBROWSER")>-1,"2345Explorer":e.indexOf("2345Explorer")>-1,TheWorld:e.indexOf("TheWorld")>-1,XiaoMi:e.indexOf("MiuiBrowser")>-1,Quark:e.indexOf("Quark")>-1,Qiyu:e.indexOf("Qiyu")>-1,Wechat:e.indexOf("MicroMessenger")>-1,Taobao:e.indexOf("AliApp(TB")>-1,Alipay:e.indexOf("AliApp(AP")>-1,Weibo:e.indexOf("Weibo")>-1,Douban:e.indexOf("com.douban.frodo")>-1,Suning:e.indexOf("SNEBUY-APP")>-1,iQiYi:e.indexOf("IqiyiApp")>-1,Windows:e.indexOf("Windows")>-1,Linux:e.indexOf("Linux")>-1||e.indexOf("X11")>-1,"Mac OS":e.indexOf("Macintosh")>-1,Android:e.indexOf("Android")>-1||e.indexOf("Adr")>-1,Ubuntu:e.indexOf("Ubuntu")>-1,FreeBSD:e.indexOf("FreeBSD")>-1,Debian:e.indexOf("Debian")>-1,"Windows Phone":e.indexOf("IEMobile")>-1||e.indexOf("Windows Phone")>-1,BlackBerry:e.indexOf("BlackBerry")>-1||e.indexOf("RIM")>-1,MeeGo:e.indexOf("MeeGo")>-1,Symbian:e.indexOf("Symbian")>-1,iOS:e.indexOf("like Mac OS X")>-1,"Chrome OS":e.indexOf("CrOS")>-1,WebOS:e.indexOf("hpwOS")>-1,Mobile:e.indexOf("Mobi")>-1||e.indexOf("iPh")>-1||e.indexOf("480")>-1,Tablet:e.indexOf("Tablet")>-1||e.indexOf("Nexus 7")>-1,iPad:e.indexOf("iPad")>-1}},matchInfoMap:function(e){var r=O.navigator.userAgent||{},n=m.getMatchMap(r);for(var t in O.infoMap)for(var o=0;o<O.infoMap[t].length;o++){var i=O.infoMap[t][o];n[i]&&(e[t]=i)}},getOS:function(){return m.matchInfoMap(this),this.os},getOSVersion:function(){var e=this,r=O.navigator.userAgent||{};e.osVersion="";var n={Windows:function(){var e=r.replace(/^.*Windows NT ([\d.]+);.*$/,"$1");return{6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[e]||e},Android:function(){return r.replace(/^.*Android ([\d.]+);.*$/,"$1")},iOS:function(){return r.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return r.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return r.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return r.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return r.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};return n[e.os]&&(e.osVersion=n[e.os](),e.osVersion==r&&(e.osVersion="")),e.osVersion},getOrientationStatu:function(){return window.matchMedia("(orientation: portrait)").matches?"竖屏":"横屏"},getDeviceType:function(){var e=this;return e.device="PC",m.matchInfoMap(e),e.device},getNetwork:function(){var e,r;return null===(e=navigator)||void 0===e||null===(r=e.connection)||void 0===r?void 0:r.effectiveType},getLanguage:function(){var e;return this.language=((e=(O.navigator.browserLanguage||O.navigator.language).split("-"))[1]&&(e[1]=e[1].toUpperCase()),e.join("_")),this.language},createFingerprint:function(e){var r=document.createElement("canvas"),n=r.getContext("2d"),t=e||window.location.host;n.textBaseline="top",n.font="14px 'Arial'",n.textBaseline="alphabetic",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText(t,2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText(t,4,17);var o=r.toDataURL().replace("data:image/png;base64,","");return function(e){var r,n,t,o="";for(r=0,n=(e+="").length;r<n;r++)o+=(t=e.charCodeAt(r).toString(16)).length<2?"0"+t:t;return o}(atob(o).slice(-16,-12))},getBrowserInfo:function(){var e=this;m.matchInfoMap(e);var r=O.navigator.userAgent||{},n=function(e,r){var n=O.navigator.mimeTypes;for(var t in n)if(n[t][e]==r)return!0;return!1},t=m.getMatchMap(r),o=!1;if(v.chrome){var i=r.replace(/^.*Chrome\/([\d]+).*$/,"$1");i>36&&v.showModalDialog?o=!0:i>45&&(o=n("type","application/vnd.chromium.remoting-viewer"))}if(t.Baidu&&t.Opera&&(t.Baidu=!1),t.Mobile&&(t.Mobile=!(r.indexOf("iPad")>-1)),o&&(n("type","application/gameplugin")||O.navigator&&void 0===O.navigator.connection.saveData?t["360SE"]=!0:t["360EE"]=!0),t.IE||t.Edge)switch(window.screenTop-window.screenY){case 71:case 74:case 99:break;case 102:t["360EE"]=!0;break;case 75:case 74:case 105:break;case 104:t["360SE"]=!0}var a={Safari:function(){return r.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return r.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return r.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return r.replace(/^.*Edge\/([\d.]+).*$/,"$1")},Firefox:function(){return r.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return r.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return r.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return r.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return r.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return r.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Arora:function(){return r.replace(/^.*Arora\/([\d.]+).*$/,"$1")},Lunascape:function(){return r.replace(/^.*Lunascape[\/\s]([\d.]+).*$/,"$1")},QupZilla:function(){return r.replace(/^.*QupZilla[\/\s]([\d.]+).*$/,"$1")},"Coc Coc":function(){return r.replace(/^.*coc_coc_browser\/([\d.]+).*$/,"$1")},Kindle:function(){return r.replace(/^.*Version\/([\d.]+).*$/,"$1")},Iceweasel:function(){return r.replace(/^.*Iceweasel\/([\d.]+).*$/,"$1")},Konqueror:function(){return r.replace(/^.*Konqueror\/([\d.]+).*$/,"$1")},Iceape:function(){return r.replace(/^.*Iceape\/([\d.]+).*$/,"$1")},SeaMonkey:function(){return r.replace(/^.*SeaMonkey\/([\d.]+).*$/,"$1")},Epiphany:function(){return r.replace(/^.*Epiphany\/([\d.]+).*$/,"$1")},360:function(){return r.replace(/^.*QihooBrowser\/([\d.]+).*$/,"$1")},"360SE":function(){return{63:"10.0",55:"9.1",45:"8.1",42:"8.0",31:"7.0",21:"6.3"}[r.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"360EE":function(){return{69:"11.0",63:"9.5",55:"9.0",50:"8.7",30:"7.5"}[r.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},Maxthon:function(){return r.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return r.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return r.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return r.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1")},UC:function(){return r.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return r.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},LBBROWSER:function(){return{57:"6.5",49:"6.0",46:"5.9",42:"5.3",39:"5.2",34:"5.0",29:"4.5",21:"4.0"}[navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"2345Explorer":function(){return r.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1")},TheWorld:function(){return r.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return r.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return r.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return r.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return r.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},Taobao:function(){return r.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return r.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return r.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return r.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return r.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return r.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")}};return e.browserVersion="",a[e.browser]&&(e.browserVersion=a[e.browser](),e.browserVersion==r&&(e.browserVersion="")),"Edge"==e.browser&&(e.engine="EdgeHTML"),"Chrome"==e.browser&&parseInt(e.browserVersion)>27&&(e.engine="Blink"),"Opera"==e.browser&&parseInt(e.browserVersion)>12&&(e.engine="Blink"),"Yandex"==e.browser&&(e.engine="Blink"),e.browser+"（版本: "+e.browserVersion+"&nbsp;&nbsp;内核: "+e.engine+"）"}},y={DeviceInfoObj:function(e){e=e||{domain:""};var r={deviceType:m.getDeviceType(),OS:m.getOS(),OSVersion:m.getOSVersion(),screenHeight:v.screen.height,screenWidth:v.screen.width,language:m.getLanguage(),netWork:m.getNetwork(),orientation:m.getOrientationStatu(),browserInfo:m.getBrowserInfo(),fingerprint:m.createFingerprint(e.domain),userAgent:O.navigator.userAgent};if(!e.info||0==e.info.length)return r;var n={},t=function(t){e.info.forEach((function(e){e.toLowerCase()==t.toLowerCase()&&(n[e=t]=r[e])}))};for(var o in r)t(o);return n}},{getDeviceInfo:function(e){return y.DeviceInfoObj(e)}});function b(e){if(!e)return!1;return/^[hH][tT][tT][pP]([sS]?):\/\//.test(e)}function R(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")}function $(e){return"Function"===R(e)}var k=function(e){c(n,e);var r=h(n);function n(){return t(this,n),r.call(this)}return n}(d(Date));k.prototype.format=function(e){var r={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[this.getDay()+""])),r)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return e};var T=function(){function e(r){t(this,e),this.url=r}return i(e,[{key:"report",value:function(e){b(this.url)?this.reportByImg(e):console.log("上报信息url地址格式不正确,url=",this.url)}},{key:"sendInfo",value:function(e){var r=JSON.stringify(e);try{if(fetch)return void fetch(this.url,{headers:{"Content-Type":"application/json"},method:"POST",body:r,mode:"same-origin",keepalive:!0})}catch(e){console.log("fetch请求异常",e)}try{var n=new XMLHttpRequest;n.open("POST",this.url,!0),n.setRequestHeader("Content-Type","application/json"),n.send(r)}catch(e){console.log(e)}}},{key:"reportByImg",value:function(e){if(b(this.url))try{(new Image).src=this.url+"/up.gif?v="+(new Date).getTime()+"&"+this.formatParams(e)}catch(e){console.log(e)}else console.log("上报信息url地址格式不正确,url=",this.url)}},{key:"reportByNavigator",value:function(e){navigator.sendBeacon&&navigator.sendBeacon(this.url,e)}},{key:"formatParams",value:function(e){var r=[];for(var n in e)r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return r.join("&")}}]),e}(),I={isStop:!0,queues:[],add:function(e,r){this.queues.push({reportUrl:e,data:r})},fire:function(){if(this.queues&&0!==this.queues.length){this.isStop=!1;var e=this.queues[0];e.reportUrl&&new T(e.reportUrl).report(e.data),this.queues.splice(0,1),this.fire()}else this.isStop=!0}},M=function(){function e(r){t(this,e),this.category=E.UNKNOW_ERROR,this.level=x.INFO,this.msg="",this.url="",this.line="",this.col="",this.errorObj={},this.reportUrl=r.reportUrl,this.extendsInfo=r.extendsInfo}return i(e,[{key:"recordError",value:function(){this.handleRecordError(),setTimeout((function(){I.isStop&&I.fire()}),100)}},{key:"handleRecordError",value:function(){try{if(!this.msg)return;if(this.reportUrl&&this.url&&this.url.toLowerCase().indexOf(this.reportUrl.toLowerCase())>=0)return void console.log("统计错误接口异常",this.msg);var e=this.handleErrorInfo();console.log("\n````````````````````` "+this.category+" `````````````````````\n",e),I.add(this.reportUrl,e)}catch(e){console.log(e)}}},{key:"handleErrorInfo",value:function(){var e="errortype: "+this.category+"\r\n";switch(console.log("this: ",this),e+="loginformation: "+this.msg+"\r\n",e+="url: "+encodeURIComponent(this.url)+"\r\n",this.category){case E.JS_ERROR:e+="errorline: "+this.line+"\r\n",e+="errorcol: "+this.col+"\r\n",this.errorObj&&this.errorObj.stack&&(e+="errorstack: "+this.errorObj.stack+"\r\n");break;default:e+="errorother: "+JSON.stringify(this.errorObj)+"\r\n"}var r=this.getDeviceInfo(),n=this.getExtendsInfo();return n.category=this.category,n.logType=this.level,n.logInfo=e,n.deviceInfo=r,n}},{key:"getExtendsInfo",value:function(){try{var e,r={},t=this.extendsInfo||{};for(var o in $(t.getDynamic)&&(e=t.getDynamic()),"Object"===R(e)&&(t=n(n({},t),e)),t)$(t[o])||(r[o]=t[o]);return r}catch(e){return console.log("call getExtendsInfo error",e),{}}}},{key:"getDeviceInfo",value:function(){try{var e=w.getDeviceInfo();return JSON.stringify(e)}catch(e){return console.log(e),""}}}]),e}(),P=function(){function e(r){t(this,e),this.params=r}return i(e,[{key:"handleError",value:function(e,r){switch(e){case S.AXIOS:new _(this.params).handleError(r);break;default:new B(this.params).handleError()}}}]),e}(),_=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(e){e&&e.config&&e.config.url&&(this.url=e.config.url),this.level=x.WARN,this.category=E.AJAX_ERROR,this.msg=JSON.stringify(e),this.recordError()}}]),n}(M),B=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(){var e=this;if(window.XMLHttpRequest){var r=XMLHttpRequest.prototype.send,n=function(r){try{var n;200!==(null==r||null===(n=r.currentTarget)||void 0===n?void 0:n.status)&&(e.level=x.WARN,e.category=E.AJAX_ERROR,e.msg=r.target.response,e.url=r.target.responseURL,e.errorObj={status:r.target.status,statusText:r.target.statusText},e.recordError())}catch(e){console.log(e)}};XMLHttpRequest.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",n),this.addEventListener("load",n),this.addEventListener("abort",n);else{var e=this.onreadystatechange;this.onreadystatechange=function(r){e.apply(this,arguments),4===this.readyState&&n(r)}}return r.apply(this,arguments)}}}}]),n}(M),C=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(){var e=this;window.onerror=function(r,n,t,o,i){try{e.level=x.WARN,e.category=E.JS_ERROR,e.msg=r,e.url=n,e.line=t,e.col=o,e.errorObj=i,e.recordError()}catch(i){console.log("js错误异常",i)}}}}]),n}(M),A=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(){var e=this;window.addEventListener("unhandledrejection",(function(r){try{if(!r||!r.reason)return;r.reason.config&&r.reason.config.url&&(e.url=r.reason.config.url),e.level=x.WARN,e.category=E.PROMISE_ERROR,e.msg=r.reason,e.recordError()}catch(e){console.log(e)}}),!0)}}]),n}(M),L=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(){var e=this;window.addEventListener("error",(function(r){try{if(!r)return;e.category=E.RESOURCE_ERROR;var n=r.target||r.srcElement;if(!(n instanceof HTMLScriptElement||n instanceof HTMLLinkElement||n instanceof HTMLImageElement))return;e.level="IMG"===n.tagName.toUpperCase()?x.WARN:x.ERROR,e.msg="加载 "+n.tagName+" 资源错误",e.url=n.src||n.href,e.errorObj=n,e.recordError()}catch(e){console.log("资源加载收集异常",e)}}),!0)}}]),n}(M),j=function(e){c(n,e);var r=h(n);function n(e){return t(this,n),r.call(this,e)}return i(n,[{key:"handleError",value:function(e){var r=this;e&&(e.config.errorHandler=function(e,n,t){try{var o={message:e.message,stack:e.stack,info:t};"[object Object]"===Object.prototype.toString.call(n)&&(o.componentName=n._isVue?n.$options.name||n.$options._componentTag:n.name,o.propsData=n.$options.propsData),r.level=x.WARN,r.msg=JSON.stringify(o),r.category=E.VUE_ERROR,r.recordError()}catch(e){console.log("vue错误异常",e)}})}}]),n}(M),F={getTiming:function(){try{if(!window.performance||!window.performance.timing)return void console.log("你的浏览器不支持 performance 操作");var e=window.performance.timing,r={};return e.loadEventEnd-e.loadEventStart<0?void setTimeout((function(){F.getTiming()}),200):(r.redirectTime=(e.redirectEnd-e.redirectStart).toFixed(2),r.dnsTime=(e.domainLookupEnd-e.domainLookupStart).toFixed(2),r.ttfbTime=(e.responseStart-e.navigationStart).toFixed(2),r.appcacheTime=(e.domainLookupStart-e.fetchStart).toFixed(2),r.unloadTime=(e.unloadEventEnd-e.unloadEventStart).toFixed(2),r.tcpTime=(e.connectEnd-e.connectStart).toFixed(2),r.reqTime=(e.responseEnd-e.responseStart).toFixed(2),r.analysisTime=(e.domComplete-e.domInteractive).toFixed(2),r.blankTime=(e.domLoading-e.navigationStart).toFixed(2),r.domReadyTime=(e.domContentLoadedEventEnd-e.navigationStart).toFixed(2),r.loadPageTime=(e.loadEventEnd-e.navigationStart).toFixed(2),r)}catch(e){console.log(e)}},getEntries:function(e){if(e=e||[],window.performance&&window.performance.getEntries){var r=[],n=window.performance.getEntries();return n&&0!=n.length?(n.forEach((function(n){var t={};e.indexOf(n.initiatorType)>-1&&(t.name=n.name,t.initiatorType=n.initiatorType,t.nextHopProtocol=n.nextHopProtocol,t.redirectTime=(n.redirectEnd-n.redirectStart).toFixed(2),t.dnsTime=(n.domainLookupEnd-n.domainLookupStart).toFixed(2),t.tcpTime=(n.connectEnd-n.connectStart).toFixed(2),t.ttfbTime=(n.responseStart-n.requestStart).toFixed(2),t.responseTime=(n.responseEnd-n.responseStart).toFixed(2),t.reqTotalTime=(n.responseEnd-n.requestStart).toFixed(2),r.push(t))})),r):r}console.log("该浏览器不支持performance.getEntries方法")}},U=function(e){c(o,e);var r=h(o);function o(e){var n;return t(this,o),n=r.call(this,e),e.isPage=!1!==e.isPage,e.isResource=!1!==e.isResource,n.isPage=e.isPage,n.isResource=e.isResource,n.usefulType=n.getSourceType(e),n.outTime=50,n.config={resourceList:[],performance:{}},n.category=E.PERFORMANCE,n.pageId=e.pageId||"",n.url=e.url||"",n}return i(o,[{key:"getSourceType",value:function(e){var r=[];return!1!==e.isRScript&&r.push("script"),!1!==e.isRCSS&&r.push("css"),!1!==e.isRFetch&&r.push("fetch"),!1!==e.isRXHR&&r.push("xmlhttprequest"),!1!==e.isRLink&&r.push("link"),!1!==e.isRIMG&&r.push("img"),r}},{key:"record",value:function(){try{this.isPage&&(this.config.performance=F.getTiming()),this.isResource&&(this.config.resourceList=F.getEntries(this.usefulType));var e={curTime:(new k).format("yyyy-MM-dd HH:mm:ss"),performance:this.config.performance,resourceList:this.config.resourceList,markUser:this.markUser(),markUv:this.markUv(),deviceInfo:this.getDeviceInfo()},r=n(n({},this.getExtendsInfo()),{},{category:this.category,logType:x.INFO,logInfo:JSON.stringify(e),pageId:this.pageId});localStorage.setItem("page_performance",JSON.stringify(r)),new T(this.url).report(r),this.clearPerformance()}catch(e){console.log("性能信息上报异常",e)}}},{key:"randomString",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",n=r.length,t="",o=0;o<e;o++)t+=r.charAt(Math.floor(Math.random()*n));return t+(new Date).getTime()}},{key:"markUser",value:function(){var e=sessionStorage.getItem("ps_markUser")||"";return e||(e=this.randomString(),sessionStorage.setItem("ps_markUser",e)),e}},{key:"markUv",value:function(){var e=new Date,r=localStorage.getItem("ps_markUv")||"",n=localStorage.getItem("ps_markUvTime")||"",t=(new k).format("yyyy/MM/dd 23:59:59");return(!r&&!n||e.getTime()>1*n)&&(r=this.randomString(),localStorage.setItem("ps_markUv",r),localStorage.setItem("ps_markUvTime",new Date(t).getTime()+"")),r}},{key:"clearPerformance",value:function(){var e,r;null!==(e=window)&&void 0!==e&&null!==(r=e.performance)&&void 0!==r&&r.clearResourceTimings&&(performance.clearResourceTimings(),this.config.performance={},this.config.resourceList="")}}]),o}(M),D=function(){function e(){t(this,e),this.jsError=!0,this.promiseError=!0,this.resourceError=!0,this.ajaxError=!0,this.vueError=!1}return i(e,[{key:"init",value:function(e){if(!e.url||b(e.url))throw"url is error,".concat(e.url);if(!e.appID||b(e.url))throw"url is error,".concat(e.url);this.jsError=!(!1===(null==e?void 0:e.jsError)),this.promiseError=!(!1===(null==e?void 0:e.promiseError)),this.resourceError=!(!1===(null==e?void 0:e.resourceError)),this.ajaxError=!(!1===(null==e?void 0:e.ajaxError)),this.vueError=!0===(null==e?void 0:e.vueError);var r=e.url,n=e.appID,t={reportUrl:r,extendsInfo:e.extendsInfo||{},appID:n};this.jsError&&new C(t).handleError(),this.promiseError&&new A(t).handleError(),this.resourceError&&new L(t).handleError(),this.ajaxError&&new P(t).handleError(S.DEFAULT),this.vueError&&e.vue&&new j(t).handleError(e.vue),this.monitorPerformance(e)}},{key:"monitorPerformance",value:function(e){e=e||{};var r=function(){new U(e).record()};r(),window.removeEventListener("unload",r),window.addEventListener("unload",r)}}]),e}();window.MonitorJS=D,e.MonitorJS=D,Object.defineProperty(e,"__esModule",{value:!0})}));
